# 训练测试
cd ~/Desktop/stagedp
conda activate equidiff
或者conda activate dp_sim

CUDA_VISIBLE_DEVICES=0 HYDRA_FULL_ERROR=1 
CUDA_VISIBLE_DEVICES=1 HYDRA_FULL_ERROR=1 


## ac算法
python train_sim.py --config-name=robomimic_train_ac_diffusion_unet_abs task_name=stack_d1 n_demo=200
v0能运行 在60-70分钟
v2能运行 在1+21 3+31  分钟

python train_sim.py --config-name=robomimic_train_ac_diffusion_unet_abs_mul task_name=stack_d1 n_demo=200






##  原始dp的unet的abs
###  demo=400   50次测试，成功率98(epoch65时ckpt=1.0开始未更新，即成功率没法更大变化)
训练：
python train_sim.py --config-name=robomimic_train_dp_diffusion_unet_abs task_name=stack_d1 n_demo=400
2分钟一个epoch ，50000/400=125个epoch，15gb 
8月15日19.41.57_diff_c_stack_d1
测试：
python eval_sim.py --checkpoint /media/disk7t/outputs/2025.08.15/19.41.57_diff_c_stack_d1/checkpoints/latest.ckpt -o data/stack_d1_eval_output_08151941

###  demo=200   50次测试，成功率88(epoch160到250，ckpt=0.92-0.94未更新，即成功率没大变化)
训练：
python train_sim.py --config-name=robomimic_train_dp_diffusion_unet_abs task_name=stack_d1 n_demo=200
1分钟一个epoch ，50000/200=250个epoch，15gb 
8月16日00.09.54_diff_c_stack_d1
测试：
python eval_sim.py --checkpoint /media/disk7t/outputs/2025.08.16/00.09.54_diff_c_stack_d1/checkpoints/latest.ckpt -o data/stack_d1_eval_output_08160009

###  demo=100   50次测试，成功率66(epoch110到250，ckpt=0.66未更新，即成功率没大变化)
训练：
python train_sim.py --config-name=robomimic_train_dp_diffusion_unet_abs task_name=stack_d1 n_demo=100
15s一个epoch 设定250个epoch，17gb 
8月16日15.44.55_diff_c_stack_d1
测试：
python eval_sim.py --checkpoint /home/hy/Desktop/stagedp/data/outputs/2025.08.16/15.44.55_diff_c_stack_d1/checkpoints/epoch=0110-test_mean_score=0.6600.ckpt -o data/stack_d1_eval_output_08160009

## ————demo=200适合作为baseline
###  修改ddpm到ddim    50次测试，成功率90(epoch120到250，ckpt=0.94未更新，即成功率没大变化,190 250)
训练：
python train_sim.py --config-name=robomimic_train_dp_diffusion_unet_abs_ddim task_name=stack_d1 n_demo=200
35s一个epoch 设定250个epoch， 
8月16日19.25.43_diff_c_stack_d1
测试：
python eval_sim.py --checkpoint /media/disk7t/outputs/2025.08.16/19.25.43_diff_c_stack_d1/checkpoints/epoch=0190-test_mean_score=0.9400.ckpt -o data/stack_d1_eval_output_08161925
成功率:

## 待运行,降低1/3内存，速度*3
###  修改une网络的down_dims，[512, 1024, 2048]降低到[256, 512, 1024]
训练：
python train_sim.py --config-name=robomimic_train_dp_diffusion_unet_abs_unet256 task_name=stack_d1 n_demo=200
20s一个epoch 设定600个epoch，10gb 
8月16日
测试：
python eval_sim.py --checkpoint /.ckpt -o data/stack_d1_eval_output_
成功率:

## 待运行
###  修改图像分辨率从84x84到224x224
生成数据：生成agentview_image和robot0_eye_in_hand_image两个相机的224数据
    ```bash
    python diffusion_policy/scripts/dataset_states_to_obs.py \
    --input data/robomimic/datasets/stack_d1/stack_d1.hdf5 \
    --output data/robomimic/datasets/stack_d1/stack_d1_224.hdf5 \
    --num_workers=16 \
    --camera_names agentview robot0_eye_in_hand \
    --camera_height=224 \
    --camera_width=224 \
    --copy_rewards \
    --copy_dones \
    --exclude-next-obs=True \
    --compress=True
    ```
--copy_rewards \  # 复制原始奖励信号
--copy_dones \    # 复制原始done信号
--exclude_next_obs \ # 保持原始next_obs排除设置
--compress \      # 保持原始压缩设置

训练：
python train_sim.py --config-name=robomimic_train_dp_diffusion_unet_abs_224 task_name=stack_d1 n_demo=200
60s一个epoch 设定600个epoch，20gb 
8月16日
测试：
python eval_sim.py --checkpoint /.ckpt -o data/stack_d1_eval_output_
成功率:


###  原始dp的unet的transformer  50次测试，成功率70(epoch150开始 ，ckpt=0.76未更新，即成功率没大变化,190 250)
训练：
python train_sim.py --config-name=robomimic_train_dp_diffusion_transformer_abs task_name=stack_d1 n_demo=200
8月17日01.22.11_diff_t_stack_d1
测试：
python eval_sim.py --checkpoint /media/disk7t/outputs/2025.08.17/01.22.11_diff_t_stack_d1/checkpoints/latest.ckpt -o data/stack_d1_eval_output_08170122


###  eqdp的unet的abs    50次测试，成功率96(epoch220开始到360 ，ckpt=1.00未更新，即成功率没大变化)
python train_sim.py --config-name=robomimic_train_equi_diffusion_unet_abs task_name=stack_d1 n_demo=200
2分钟一个epoch，600个epoch，21gb
8月16日23.23.16_equi_diff_stack_d1_abs
测试：
python eval_sim.py --checkpoint /media/disk7t/outputs/2025.08.16/23.23.31_equi_diff_stack_d1/checkpoints/latest.ckpt -o data/stack_d1_eval_output_08162323

###  eqdp的unet的rel 
python train_sim.py --config-name=robomimic_train_equi_diffusion_unet_rel task_name=stack_d1 n_demo=200
5分钟一个epoch ，50000/400=125个epoch，21gb
8月15日19.36.58_equi_diff_stack_d1



转换：
python /home/hy/Desktop/stagedp/acdp/scripts/robomimic_dataset_conversion_gpu.py \
-i data/robomimic/datasets/stack_d1/stack_d1_224.hdf5 \
-o data/robomimic/datasets/stack_d1/stack_d1_abs_224.hdf5 \
-n 32 \
--use_gpu \
--suppress_warnings